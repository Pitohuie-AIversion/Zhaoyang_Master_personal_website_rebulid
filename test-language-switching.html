<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>语言切换测试 - Language Switching Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .pass { background-color: #d4edda; border-color: #c3e6cb; }
        .fail { background-color: #f8d7da; border-color: #f5c6cb; }
        .warning { background-color: #fff3cd; border-color: #ffeaa7; }
        .test-result {
            font-weight: bold;
            margin-top: 10px;
        }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>语言切换功能测试报告</h1>
    <p>测试时间: <span id="test-time"></span></p>
    
    <div class="test-section">
        <h2>1. 翻译文件结构测试</h2>
        <div id="translation-structure-test"></div>
    </div>
    
    <div class="test-section">
        <h2>2. 关键翻译键测试</h2>
        <div id="key-translation-test"></div>
    </div>
    
    <div class="test-section">
        <h2>3. 学术内容数据完整性测试</h2>
        <div id="academic-content-test"></div>
    </div>
    
    <div class="test-section">
        <h2>4. 语言切换功能测试</h2>
        <div id="language-switching-test"></div>
    </div>

    <script type="module">
        // 测试时间
        document.getElementById('test-time').textContent = new Date().toLocaleString('zh-CN');
        
        // 模拟翻译数据
        const zhTranslations = {
            "common": {
                "loading": "加载中...",
                "error": "出错了",
                "search": "搜索"
            },
            "navigation": {
                "home": "首页",
                "research": "学术研究",
                "projects": "项目作品",
                "publications": "学术成果",
                "skills": "技能专长",
                "contact": "联系我"
            },
            "research": {
                "title": "学术研究",
                "description": "探索前沿科学技术，推动学术创新与实际应用的深度融合",
                "publications": {
                    "title": "论文发表",
                    "damformer": {
                        "title": "DAMFormer: 基于Transformer的大坝溃坝洪水预测模型",
                        "journal": "Physics of Fluids",
                        "year": "2025",
                        "authors": ["Zhaoyang Mu", "其他作者"],
                        "description": "提出了一个基于Transformer架构的大坝溃坝洪水预测模型..."
                    }
                }
            }
        };
        
        const enTranslations = {
            "common": {
                "loading": "Loading...",
                "error": "Error",
                "search": "Search"
            },
            "navigation": {
                "home": "Home",
                "research": "Research",
                "projects": "Projects", 
                "publications": "Publications",
                "skills": "Skills",
                "contact": "Contact"
            },
            "research": {
                "title": "Academic Research",
                "description": "Exploring cutting-edge science and technology, driving deep integration of academic innovation and practical applications",
                "publications": {
                    "title": "Publications",
                    "damformer": {
                        "title": "DAMFormer: Transformer-based Dam Break Flood Prediction Model",
                        "journal": "Physics of Fluids",
                        "year": "2025",
                        "authors": ["Zhaoyang Mu", "Other Authors"],
                        "description": "Proposes a Transformer-based architecture for dam break flood prediction..."
                    }
                }
            }
        };
        
        // 翻译函数
        function getTranslation(key, language, fallback) {
            const keys = key.split('.');
            let value = language === 'zh' ? zhTranslations : enTranslations;
            
            for (const k of keys) {
                if (value && typeof value === 'object' && k in value) {
                    value = value[k];
                } else {
                    // 如果找不到翻译，尝试使用备用语言
                    const fallbackLang = language === 'zh' ? 'en' : 'zh';
                    let fallbackValue = fallbackLang === 'zh' ? zhTranslations : enTranslations;
                    
                    for (const fk of keys) {
                        if (fallbackValue && typeof fallbackValue === 'object' && fk in fallbackValue) {
                            fallbackValue = fallbackValue[fk];
                        } else {
                            fallbackValue = null;
                            break;
                        }
                    }
                    
                    if (typeof fallbackValue === 'string') {
                        return fallbackValue;
                    }
                    
                    return fallback || key;
                }
            }
            
            return typeof value === 'string' ? value : (fallback || key);
        }
        
        function createTranslationFunction(language) {
            return (key, options) => {
                const fallback = options?.fallback;
                return getTranslation(key, language, fallback);
            };
        }
        
        // 测试函数
        function runTests() {
            let testsPassed = 0;
            let totalTests = 0;
            
            // 1. 翻译文件结构测试
            function testTranslationStructure() {
                const results = [];
                
                // 检查主要命名空间是否存在
                const requiredNamespaces = ['common', 'navigation', 'research', 'projects', 'publications', 'skills', 'contact'];
                
                ['zh', 'en'].forEach(lang => {
                    const translations = lang === 'zh' ? zhTranslations : enTranslations;
                    requiredNamespaces.forEach(namespace => {
                        totalTests++;
                        if (translations[namespace]) {
                            results.push(`✅ ${lang}.${namespace} 存在`);
                            testsPassed++;
                        } else {
                            results.push(`❌ ${lang}.${namespace} 缺失`);
                        }
                    });
                });
                
                document.getElementById('translation-structure-test').innerHTML = `
                    <pre>${results.join('\n')}</pre>
                    <div class="test-result ${results.some(r => r.includes('❌')) ? 'fail' : 'pass'}">
                        结构测试: ${results.filter(r => r.includes('✅')).length}/${results.length} 通过
                    </div>
                `;
            }
            
            // 2. 关键翻译键测试
            function testKeyTranslations() {
                const testKeys = [
                    'navigation.home',
                    'navigation.research', 
                    'navigation.projects',
                    'research.title',
                    'research.description'
                ];
                
                const results = [];
                
                testKeys.forEach(key => {
                    ['zh', 'en'].forEach(lang => {
                        totalTests++;
                        const translation = getTranslation(key, lang);
                        if (translation && translation !== key) {
                            results.push(`✅ ${lang}: ${key} = "${translation}"`);
                            testsPassed++;
                        } else {
                            results.push(`❌ ${lang}: ${key} 翻译失败`);
                        }
                    });
                });
                
                document.getElementById('key-translation-test').innerHTML = `
                    <pre>${results.join('\n')}</pre>
                    <div class="test-result ${results.some(r => r.includes('❌')) ? 'fail' : 'pass'}">
                        翻译键测试: ${results.filter(r => r.includes('✅')).length}/${results.length} 通过
                    </div>
                `;
            }
            
            // 3. 学术内容数据完整性测试
            function testAcademicContent() {
                const results = [];
                
                // 测试论文数据
                const paperKeys = [
                    'research.publications.damformer.title',
                    'research.publications.damformer.journal',
                    'research.publications.damformer.description'
                ];
                
                paperKeys.forEach(key => {
                    ['zh', 'en'].forEach(lang => {
                        totalTests++;
                        const translation = getTranslation(key, lang);
                        if (translation && translation !== key && translation.length > 10) {
                            results.push(`✅ ${lang}: ${key} 内容完整`);
                            testsPassed++;
                        } else {
                            results.push(`❌ ${lang}: ${key} 内容缺失或太短`);
                        }
                    });
                });
                
                document.getElementById('academic-content-test').innerHTML = `
                    <pre>${results.join('\n')}</pre>
                    <div class="test-result ${results.some(r => r.includes('❌')) ? 'fail' : 'pass'}">
                        学术内容测试: ${results.filter(r => r.includes('✅')).length}/${results.length} 通过
                    </div>
                `;
            }
            
            // 4. 语言切换功能测试
            function testLanguageSwitching() {
                const results = [];
                
                // 模拟语言切换
                const testKey = 'navigation.research';
                const zhResult = getTranslation(testKey, 'zh');
                const enResult = getTranslation(testKey, 'en');
                
                totalTests += 2;
                
                if (zhResult && zhResult !== testKey) {
                    results.push(`✅ 中文切换: ${testKey} = "${zhResult}"`);
                    testsPassed++;
                } else {
                    results.push(`❌ 中文切换失败`);
                }
                
                if (enResult && enResult !== testKey && enResult !== zhResult) {
                    results.push(`✅ 英文切换: ${testKey} = "${enResult}"`);
                    testsPassed++;
                } else {
                    results.push(`❌ 英文切换失败`);
                }
                
                // 检查是否存在翻译重复
                if (zhResult === enResult) {
                    results.push(`⚠️ 警告: 中英文翻译相同，可能影响用户体验`);
                }
                
                document.getElementById('language-switching-test').innerHTML = `
                    <pre>${results.join('\n')}</pre>
                    <div class="test-result ${results.some(r => r.includes('❌')) ? 'fail' : results.some(r => r.includes('⚠️')) ? 'warning' : 'pass'}">
                        语言切换测试: ${results.filter(r => r.includes('✅')).length}/${results.filter(r => !r.includes('⚠️')).length} 通过
                    </div>
                `;
            }
            
            // 运行所有测试
            testTranslationStructure();
            testKeyTranslations();
            testAcademicContent();
            testLanguageSwitching();
            
            // 总体结果
            setTimeout(() => {
                const summary = document.createElement('div');
                summary.className = `test-section ${testsPassed === totalTests ? 'pass' : 'fail'}`;
                summary.innerHTML = `
                    <h2>总体测试结果</h2>
                    <p>总测试数: ${totalTests}</p>
                    <p>通过测试: ${testsPassed}</p>
                    <p>成功率: ${((testsPassed / totalTests) * 100).toFixed(1)}%</p>
                    <div class="test-result">
                        测试状态: ${testsPassed === totalTests ? '✅ 全部通过' : '❌ 部分失败'}
                    </div>
                `;
                document.body.appendChild(summary);
            }, 100);
        }
        
        // 运行测试
        runTests();
    </script>
</body>
</html>